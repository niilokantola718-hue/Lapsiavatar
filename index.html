<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Lapsi Avatar VR/3D Huone</title>
<style>
  body { margin: 0; padding: 0; overflow: hidden; background: #000; font-family: -apple-system, BlinkMacSystemFont, sans-serif; }
  #ui {
    position: absolute; top:0; left:0; width:100%; height:100%;
    display:flex; flex-direction:column; justify-content:center; align-items:center;
    z-index:1000; background: rgba(0,0,0,0.8);
  }
  button { padding:20px 40px; font-size:24px; border:none; border-radius:20px;
    color:white; cursor:pointer; margin:20px; background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
  }
  #status { color:white; background:rgba(0,0,0,0.7); padding:20px; border-radius:15px;
    margin-top:20px; text-align:center; max-width:80%; font-size:18px;
  }
</style>
</head>
<body>
<div id="ui">
  <button id="startButton">Avaa Lapsen Huone</button>
  <div id="status">Valmistellaan huonetta...</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
let scene, camera, renderer;
let avatar = null;
const status = document.getElementById('status');

function updateStatus(msg) { status.textContent = msg; console.log(msg); }

function init() {
  updateStatus("Luodaan huone...");

  scene = new THREE.Scene();
  
  // Kamera lapsen perspektiivistä
  camera = new THREE.PerspectiveCamera(50, window.innerWidth/window.innerHeight, 0.1, 100);
  camera.position.set(0, 1.15, 3); // 6-vuotiaan silmien taso

  renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
  renderer.setPixelRatio(window.devicePixelRatio);
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setClearColor(0x87CEEB, 1); // taivas/taustaväri
  document.body.appendChild(renderer.domElement);

  // Valaistus
  const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
  scene.add(ambientLight);
  const dirLight = new THREE.DirectionalLight(0xffffff, 0.5);
  dirLight.position.set(3,5,2);
  scene.add(dirLight);

  // Lattia (parketti)
  const floorTexture = new THREE.TextureLoader().load("https://threejs.org/examples/textures/hardwood2_diffuse.jpg");
  floorTexture.wrapS = floorTexture.wrapT = THREE.RepeatWrapping;
  floorTexture.repeat.set(4,4);
  const floorMat = new THREE.MeshPhongMaterial({ map: floorTexture });
  const floorGeo = new THREE.PlaneGeometry(10,10);
  const floor = new THREE.Mesh(floorGeo, floorMat);
  floor.rotation.x = -Math.PI/2;
  floor.position.y = 0;
  scene.add(floor);

  // Seinät yksinkertaisesti
  const wallMat = new THREE.MeshPhongMaterial({ color:0xeeeeee });
  const wallGeo = new THREE.PlaneGeometry(10,3);
  const backWall = new THREE.Mesh(wallGeo, wallMat);
  backWall.position.z = -5; backWall.position.y = 1.5;
  scene.add(backWall);

  const leftWall = new THREE.Mesh(wallGeo, wallMat);
  leftWall.rotation.y = Math.PI/2; leftWall.position.x = -5; leftWall.position.y = 1.5;
  scene.add(leftWall);

  const rightWall = new THREE.Mesh(wallGeo, wallMat);
  rightWall.rotation.y = -Math.PI/2; rightWall.position.x = 5; rightWall.position.y = 1.5;
  scene.add(rightWall);

  // Pieni pöytä
  const tableGeo = new THREE.BoxGeometry(1.2,0.5,0.6);
  const tableMat = new THREE.MeshPhongMaterial({ color:0x8B4513 });
  const table = new THREE.Mesh(tableGeo, tableMat);
  table.position.set(0,0.25,0);
  scene.add(table);

  // Avatar lapsena
  createAvatar();

  document.getElementById("startButton").addEventListener("click", start3DExperience);
  window.addEventListener("resize", onWindowResize);
  
  updateStatus("Huone valmis – paina nappia nähdäksesi sen lapsen silmin!");
}

function createAvatar() {
  avatar = new THREE.Group();
  const headGeo = new THREE.SphereGeometry(0.15,16,16);
  const headMat = new THREE.MeshPhongMaterial({ color:0xFFD700, transparent:true, opacity:0.8 });
  const head = new THREE.Mesh(headGeo, headMat);
  head.position.y = 0.15;
  avatar.add(head);

  const bodyGeo = new THREE.CylinderGeometry(0.12,0.15,0.4,16);
  const bodyMat = new THREE.MeshPhongMaterial({ color:0x4169E1, transparent:true, opacity:0.8 });
  const body = new THREE.Mesh(bodyGeo, bodyMat);
  body.position.y = -0.2;
  avatar.add(body);

  avatar.position.set(0,0,0);
  scene.add(avatar);
}

function start3DExperience() {
  updateStatus("Näytetään huone lapsen silmin...");
  document.getElementById("ui").style.display = "none";
  animate();
}

function onWindowResize() {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
}

function animate() {
  requestAnimationFrame(animate);
  renderer.render(scene, camera);
}

window.addEventListener("load", init);
</script>
</body>
</html>
