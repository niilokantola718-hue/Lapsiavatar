<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lapsi Avatar VR</title>
    <style>
        body { margin:0; overflow:hidden; background:black; }
        #info {
            position:absolute; top:20px; left:20px; background:rgba(0,0,0,0.8); color:white;
            padding:15px; border-radius:10px; font-family:Arial,sans-serif; z-index:100;
        }
        button {
            padding:12px 20px; font-size:16px; margin:5px;
            border:none; border-radius:8px; cursor:pointer; background:#4CAF50; color:white;
        }
    </style>
</head>
<body>
    <div id="info">
        <button id="startVR">ðŸš€ KÃ¤ynnistÃ¤ VR</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script>
        let scene, camera, renderer, avatar, xrSession;

        init();

        function init(){
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);

            // Kamera lapsen korkeudella 4-vuotiaalle (~1.0 m)
            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.01, 1000);
            camera.position.set(0, 1.0, 3);

            renderer = new THREE.WebGLRenderer({antialias:true});
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.xr.enabled = true;
            document.body.appendChild(renderer.domElement);

            // Valaistus
            scene.add(new THREE.AmbientLight(0xffffff,0.6));
            const dirLight = new THREE.DirectionalLight(0xffffff,0.8);
            dirLight.position.set(10,20,10);
            scene.add(dirLight);

            // Virtuaalinen parkettilattia epÃ¤tasaisuuksineen
            const floorGeom = new THREE.PlaneGeometry(10,10,20,20);
            floorGeom.vertices.forEach(v=>{
                v.z += (Math.random()-0.5)*0.05; // pieni epÃ¤tasaisuus
            });
            const floorMat = new THREE.MeshStandardMaterial({color:0xDEB887, side:THREE.DoubleSide});
            const floor = new THREE.Mesh(floorGeom,floorMat);
            floor.rotation.x = -Math.PI/2;
            scene.add(floor);

            // PÃ¶ytÃ¤
            const table = new THREE.Mesh(
                new THREE.BoxGeometry(2,0.75,1.5),
                new THREE.MeshStandardMaterial({color:0x8B4513})
            );
            table.position.set(0,0.375,-2);
            scene.add(table);

            // Tuoli
            const chair = new THREE.Mesh(
                new THREE.BoxGeometry(0.7,0.45,0.7),
                new THREE.MeshStandardMaterial({color:0xA0522D})
            );
            chair.position.set(1.5,0.225,-1);
            scene.add(chair);

            // Lapsen leluja
            const colors=[0xFF6B6B,0x4ECDC4,0x45B7D1,0x96CEB4,0xFFEAA7];
            for(let i=0;i<8;i++){
                const size=0.3+Math.random()*0.4;
                const geom = Math.random()>0.5? new THREE.SphereGeometry(size,16,16) : new THREE.BoxGeometry(size,size,size);
                const mat = new THREE.MeshStandardMaterial({color:colors[Math.floor(Math.random()*colors.length)]});
                const toy = new THREE.Mesh(geom,mat);
                toy.position.set((Math.random()-0.5)*8, size/2, -3+(Math.random()-0.5)*4);
                scene.add(toy);
            }

            // Lapsi-avatar (lÃ¤pinÃ¤kyvÃ¤)
            avatar = new THREE.Group();
            const body = new THREE.Mesh(new THREE.CylinderGeometry(0.25,0.25,0.8,8), new THREE.MeshStandardMaterial({color:0x4169E1,transparent:true,opacity:0.3}));
            body.position.y=0.4;
            avatar.add(body);
            const head = new THREE.Mesh(new THREE.SphereGeometry(0.18,16,16), new THREE.MeshStandardMaterial({color:0xFFEBCD,transparent:true,opacity:0.3}));
            head.position.y=0.9;
            avatar.add(head);
            scene.add(avatar);

            window.addEventListener('resize',onWindowResize);

            document.getElementById('startVR').addEventListener('click',startVR);
            animate();
        }

        function onWindowResize(){
            camera.aspect=window.innerWidth/window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth,window.innerHeight);
        }

        async function startVR(){
            if(!navigator.xr){ alert("WebXR ei saatavilla."); return; }
            try{
                const supported = await navigator.xr.isSessionSupported('immersive-vr');
                if(!supported){ alert("VR ei tuettu"); return; }

                xrSession = await navigator.xr.requestSession('immersive-vr',{requiredFeatures:['local-floor']});
                await renderer.xr.setSession(xrSession);

                // Lapsen nÃ¤kÃ¶kulma
                const head = new THREE.Group();
                head.position.set(0,1.0,0); // 4-vuotiaan silmien korkeus
                avatar.add(head);
                head.add(camera);
                camera.position.set(0,0,0);

                xrSession.addEventListener('end',()=>{
                    xrSession=null;
                    camera.position.set(0,1.0,3);
                });
            } catch(e){
                alert("VR epÃ¤onnistui: "+e.message);
            }
        }

        function animate(){
            renderer.setAnimationLoop(()=>{
                if(xrSession){
                    avatar.position.copy(camera.position);
                    avatar.rotation.copy(camera.rotation);
                }
                renderer.render(scene,camera);
            });
        }
    </script>
</body>
</html>
