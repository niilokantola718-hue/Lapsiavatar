<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>6-vuotiaan näkökulma VR</title>
<style>
body { margin:0; padding:0; overflow:hidden; background:#000; font-family:-apple-system, BlinkMacSystemFont, sans-serif; }
#ui {
  position:absolute; top:0; left:0; width:100%; height:100%;
  display:flex; flex-direction:column; justify-content:center; align-items:center;
  z-index:1000; background: rgba(0,0,0,0.8);
}
button {
  padding: 20px 40px; font-size:24px; background:linear-gradient(45deg,#FF6B6B,#4ECDC4);
  border:none; border-radius:20px; color:white; cursor:pointer; margin:20px;
}
#status {
  color:white; background: rgba(0,0,0,0.7); padding:20px; border-radius:15px;
  margin-top:20px; text-align:center; max-width:80%; font-size:18px;
}
</style>
</head>
<body>
<div id="ui">
  <button id="startButton">Käynnistä VR - 6-vuotiaan näkökulma</button>
  <div id="status">Valmistellaan VR-tilaa...</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
<script>
let scene, camera, renderer;
let xrSession = null;
let avatar = null;

const status = document.getElementById('status');
function updateStatus(msg){ status.textContent = msg; console.log(msg); }

async function init(){
  updateStatus('Alustetaan VR-tilaa...');
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0xa0a0a0);

  // Kamera pysyy fyysisellä pään korkeudella
  camera = new THREE.PerspectiveCamera(50, window.innerWidth/window.innerHeight, 0.01, 100);
  camera.position.set(0, 1.6, 0); // Vision Pro pääkorkeus
  renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
  renderer.setPixelRatio(window.devicePixelRatio);
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.xr.enabled = true;
  document.body.appendChild(renderer.domElement);

  // Valaistus
  const ambientLight = new THREE.AmbientLight(0xffffff,1.0); scene.add(ambientLight);
  const dirLight = new THREE.DirectionalLight(0xffffff,0.8); dirLight.position.set(5,10,5); scene.add(dirLight);

  // Luo huone
  createRoom();

  // Luo huonekaluja
  createFurniture();

  // Luo lapsiavatar
  createChildAvatar();

  // Luo parkettilattia epätasaisuuksineen
  createParketFloor();

  document.getElementById('startButton').addEventListener('click', startVRSession);
  window.addEventListener('resize', onWindowResize);

  updateStatus('Valmis - paina "Käynnistä VR"');
}

// Huone: seinät, lattia, katto
function createRoom(){
  const wallMat = new THREE.MeshPhongMaterial({ color:0xd9d9d9 });
  const floorMat = new THREE.MeshPhongMaterial({ color:0xffffff });
  const ceilingMat = new THREE.MeshPhongMaterial({ color:0xf0f0f0 });

  // Seinät
  const wallGeo = new THREE.BoxGeometry(10,4,0.2);
  const backWall = new THREE.Mesh(wallGeo, wallMat);
  backWall.position.set(0,2,-5);
  scene.add(backWall);

  const frontWall = new THREE.Mesh(wallGeo, wallMat);
  frontWall.position.set(0,2,5);
  scene.add(frontWall);

  const sideWallGeo = new THREE.BoxGeometry(0.2,4,10);
  const leftWall = new THREE.Mesh(sideWallGeo, wallMat);
  leftWall.position.set(-5,2,0);
  scene.add(leftWall);

  const rightWall = new THREE.Mesh(sideWallGeo, wallMat);
  rightWall.position.set(5,2,0);
  scene.add(rightWall);

  // Katto
  const ceilingGeo = new THREE.PlaneGeometry(10,10);
  const ceiling = new THREE.Mesh(ceilingGeo, ceilingMat);
  ceiling.rotation.x = Math.PI/2;
  ceiling.position.y = 4;
  scene.add(ceiling);
}

// Huonekaluja: pöytiä, tuoleja, kaappeja
function createFurniture(){
  const tableMat = new THREE.MeshPhongMaterial({ color:0x8B4513 });
  const chairMat = new THREE.MeshPhongMaterial({ color:0xA0522D });
  const cabinetMat = new THREE.MeshPhongMaterial({ color:0x654321 });

  // Pöytä
  const tableGeo = new THREE.BoxGeometry(2,0.75,1.2);
  const table = new THREE.Mesh(tableGeo, tableMat);
  table.position.set(0,0.375,-2);
  scene.add(table);

  // Tuolit
  const chairGeo = new THREE.BoxGeometry(0.5,0.45,0.5);
  const chair1 = new THREE.Mesh(chairGeo, chairMat);
  chair1.position.set(1,0.225,-2);
  scene.add(chair1);

  const chair2 = new THREE.Mesh(chairGeo, chairMat);
  chair2.position.set(-1,0.225,-2);
  scene.add(chair2);

  // Kaappi
  const cabinetGeo = new THREE.BoxGeometry(1,2,0.5);
  const cabinet = new THREE.Mesh(cabinetGeo, cabinetMat);
  cabinet.position.set(3,1,0);
  scene.add(cabinet);
}

// Lapsiavatar
function createChildAvatar(){
  avatar = new THREE.Group();

  const headGeo = new THREE.SphereGeometry(0.15,16,16);
  const headMat = new THREE.MeshPhongMaterial({ color:0xFFD700, transparent:true, opacity:0.8 });
  const head = new THREE.Mesh(headGeo, headMat);
  head.position.y = 0.15;
  avatar.add(head);

  const bodyGeo = new THREE.CylinderGeometry(0.12,0.15,0.3,16);
  const bodyMat = new THREE.MeshPhongMaterial({ color:0x4169E1, transparent:true, opacity:0.8 });
  const body = new THREE.Mesh(bodyGeo, bodyMat);
  body.position.y = -0.15;
  avatar.add(body);

  avatar.position.set(0,-0.6,-0.5); // nostetaan avatar ja huone niin, että kamera näkee 6-vuotiaan näkymän
  scene.add(avatar);
}

// Parkettilattia epätasaisuuksineen
function createParketFloor(){
  const floorGeo = new THREE.PlaneGeometry(10,10,20,20);
  const floorMat = new THREE.MeshPhongMaterial({ color:0xdeb887, side:THREE.DoubleSide });
  const floor = new THREE.Mesh(floorGeo, floorMat);
  floor.rotation.x = -Math.PI/2;
  floor.position.y = -0.6; // nostetaan lattiaa, jotta 6-vuotiaan näkökulma
  // epätasaisuudet
  for(let i=0;i<floorGeo.attributes.position.count;i++){
    const y = (Math.random()-0.5)*0.02;
    floorGeo.attributes.position.setY(i,y);
  }
  floorGeo.attributes.position.needsUpdate = true;
  scene.add(floor);
}

// Käynnistä VR
async function startVRSession(){
  updateStatus('Yritetään käynnistää VR...');
  try {
    const sessionInit = { optionalFeatures:['local-floor','hand-tracking','layers'] };
    const session = await navigator.xr.requestSession('immersive-vr', sessionInit);
    xrSession = session;
    await renderer.xr.setSession(session);
    document.getElementById('ui').style.display='none';
    renderer.setAnimationLoop(render);
    updateStatus('VR käynnistetty! Näet maailman 6-vuotiaan silmin.');
  } catch(e){
    updateStatus('VR-sessio epäonnistui: '+e.message);
  }
}

function onWindowResize(){
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
}

function render(){
  if(avatar &&
