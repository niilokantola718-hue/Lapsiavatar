<script>
let camera, scene, renderer;
let avatar, firstPersonView = false;

function init() {
    // Perus setup
    scene = new THREE.Scene();
    
    // Luo kamera - ALUksi third-person näkymä
    camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 2, 5); // Aluksi kaukana avatarista
    
    renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.xr.enabled = true;
    document.body.appendChild(renderer.domElement);

    // Luo avatar
    avatar = createAvatar();
    scene.add(avatar);

    // "Astu kehoon" -nappi
    const enterButton = document.createElement('button');
    enterButton.textContent = 'Astu kehoon';
    enterButton.style.position = 'absolute';
    enterButton.style.top = '20px';
    enterButton.style.left = '20px';
    enterButton.style.zIndex = '1000';
    document.body.appendChild(enterButton);

    enterButton.addEventListener('click', switchToFirstPerson);

    // Animaatio
    renderer.setAnimationLoop(animate);
}

function switchToFirstPerson() {
    if (firstPersonView) return; // Ei tehdä uudestaan
    
    firstPersonView = true;
    
    // 1. POISTA third-person kamera
    // 2. SIIRRÄ kamera avatarin PÄÄHÄN
    camera.position.set(0, 1.3, 0); // Silmien korkeus
    camera.rotation.set(0, 0, 0);
    
    // 3. LIITÄ kamera SUORAAN avatarin päähän
    // Luo "pää" -objekti avatarille
    const head = new THREE.Object3D();
    head.position.set(0, 1.3, 0); // Pään sijainti avatarissa
    avatar.add(head);
    
    // 4. KAMERA SEURAA NYT AVATARIN PÄÄTÄ
    head.add(camera);
    
    // 5. Piilota nappi
    document.querySelector('button').style.display = 'none';
    
    // 6. Vaihda taustaväri kokonaan mustaksi (ei näy selainta)
    document.body.style.background = 'black';
    document.body.style.margin = '0';
    document.body.style.padding = '0';
    document.body.style.overflow = 'hidden';
    
    console.log('Nyt olet avatarin sisällä!');
}

function createAvatar() {
    const group = new THREE.Group();
    
    // Vartalo (mutta et näe sitä first-person näkymässä)
    const bodyGeometry = new THREE.CylinderGeometry(0.3, 0.3, 1.2);
    const bodyMaterial = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
    const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
    body.position.y = 0.6;
    group.add(body);
    
    // Pää (tähän kamera kiinnitetään)
    const headGeometry = new THREE.SphereGeometry(0.2);
    const headMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 });
    const head = new THREE.Mesh(headGeometry, headMaterial);
    head.position.y = 1.3;
    group.add(head);
    
    return group;
}

function animate() {
    // Liikuta avataria testiksi
    if (firstPersonView) {
        // Kun olet avatarin sisällä, voit liikuttaa sitä
        avatar.rotation.y += 0.01;
    }
    
    renderer.render(scene, camera);
}

init();
</script>

