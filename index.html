<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>4-vuotiaan lapsi VR-huone</title>
<style>
body { margin:0; overflow:hidden; background:black; }
#info {
    position:absolute; top:10px; left:10px; z-index:100;
    background:rgba(0,0,0,0.7); color:white; padding:15px; border-radius:8px;
}
button { padding:10px 20px; font-size:16px; margin:5px; }
</style>
</head>
<body>
<div id="info">
<h2>4-vuotiaan lapsi VR-huone</h2>
<button id="startVR">üöÄ K√§ynnist√§ VR</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
<script>
let scene, camera, renderer, avatar;

function initScene() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x87CEEB);

    // Kamera 4-vuotiaan silmien korkeudella ~1.0 m
    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.01, 1000);
    camera.position.set(0,1.0,3);

    renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.xr.enabled = true;
    document.body.appendChild(renderer.domElement);

    // Valaistus
    const ambient = new THREE.AmbientLight(0xffffff,0.6);
    scene.add(ambient);
    const dirLight = new THREE.DirectionalLight(0xffffff,0.8);
    dirLight.position.set(5,10,5);
    scene.add(dirLight);

    createRoom();
    createFurniture();
    createAvatar();

    window.addEventListener('resize', onResize);
    animate();
}

function createRoom(){
    // Lattia parketti ep√§tasaisuuksilla
    const floorGeom = new THREE.PlaneGeometry(10,10,20,20);
    for(let i=0;i<floorGeom.attributes.position.count;i++){
        floorGeom.attributes.position.setY(i, Math.random()*0.02);
    }
    floorGeom.computeVertexNormals();
    const floorMat = new THREE.MeshStandardMaterial({color:0xdeb887});
    const floor = new THREE.Mesh(floorGeom,floorMat);
    floor.rotation.x = -Math.PI/2;
    floor.position.y = 0;
    scene.add(floor);

    // Sein√§t
    const wallMat = new THREE.MeshStandardMaterial({color:0xadd8e6});
    const backWall = new THREE.Mesh(new THREE.BoxGeometry(10,3,0.1), wallMat);
    backWall.position.set(0,1.5,-5); scene.add(backWall);
    const leftWall = new THREE.Mesh(new THREE.BoxGeometry(0.1,3,10), wallMat);
    leftWall.position.set(-5,1.5,0); scene.add(leftWall);
    const rightWall = new THREE.Mesh(new THREE.BoxGeometry(0.1,3,10), wallMat);
    rightWall.position.set(5,1.5,0); scene.add(rightWall);

    // Katto
    const ceiling = new THREE.Mesh(new THREE.PlaneGeometry(10,10),
        new THREE.MeshStandardMaterial({color:0xeeeeee}));
    ceiling.rotation.x = Math.PI/2;
    ceiling.position.y = 3;
    scene.add(ceiling);
}

function createFurniture(){
    // P√∂yt√§
    const table = new THREE.Mesh(new THREE.BoxGeometry(2,0.75,1),
        new THREE.MeshStandardMaterial({color:0x8B4513}));
    table.position.set(0,0.375,0); scene.add(table);

    // Tuoli
    const chair = new THREE.Mesh(new THREE.BoxGeometry(0.5,0.45,0.5),
        new THREE.MeshStandardMaterial({color:0xA0522D}));
    chair.position.set(1,0.225,0); scene.add(chair);

    // Sohva
    const sofa = new THREE.Mesh(new THREE.BoxGeometry(2,0.8,1),
        new THREE.MeshStandardMaterial({color:0x556B2F}));
    sofa.position.set(-2,0.4,-2); scene.add(sofa);
}

function createAvatar(){
    avatar = new THREE.Group();
    const body = new THREE.Mesh(new THREE.CylinderGeometry(0.25,0.25,0.8,8),
        new THREE.MeshStandardMaterial({color:0x4169E1,transparent:true,opacity:0.3}));
    body.position.y=0.4; avatar.add(body);

    const head = new THREE.Mesh(new THREE.SphereGeometry(0.18,16,16),
        new THREE.MeshStandardMaterial({color:0xFFEBCD,transparent:true,opacity:0.3}));
    head.position.y=0.9; avatar.add(head);

    scene.add(avatar);
}

function onResize(){
    camera.aspect=window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
}

function animate(){
    renderer.setAnimationLoop(()=>{ renderer.render(scene,camera); });
}

document.getElementById('startVR').addEventListener('click', async ()=>{
    if(!navigator.xr){ alert("WebXR ei saatavilla!"); return; }
    try{
        const supported = await navigator.xr.isSessionSupported('immersive-vr');
        if(!supported){ alert("VR ei tuettu."); return; }
        const xrSession = await navigator.xr.requestSession('immersive-vr');
        renderer.xr.setSession(xrSession);
        alert("VR k√§ynnistetty! Olet 4-vuotiaan lapsen n√§k√∂kulmassa.");
    }catch(e){
        alert("VR ep√§onnistui: "+e.message);
    }
});

initScene();
</script>
</body>
</html>
