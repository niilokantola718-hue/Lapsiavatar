<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lapsi Avatar VR</title>
<style>
body { margin: 0; overflow: hidden; background: black; }
#arButton { position: absolute; top: 20px; left: 20px; padding: 15px 30px; font-size: 18px; background: #4CAF50; color: white; border: none; border-radius: 10px; cursor: pointer; z-index:100; }
#statusMessage { position: absolute; top: 80px; left: 20px; color: white; font-size: 18px; z-index:100; }
</style>
</head>
<body>
<button id="arButton">ðŸš€ KÃ¤ynnistÃ¤ VR</button>
<div id="statusMessage">Valmis!</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
<script>
let camera, scene, renderer, avatar;
let xrSession = null;

function init() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x87CEEB);

    // Kamera 4-vuotiaan silmien korkeudelle ~1.0 m
    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.01, 1000);
    camera.position.set(0, 1.0, 3);

    // Renderer
    renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.xr.enabled = true;
    document.body.appendChild(renderer.domElement);

    // Valaistus
    const ambient = new THREE.AmbientLight(0xffffff, 0.6);
    scene.add(ambient);
    const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
    dirLight.position.set(10,20,10);
    scene.add(dirLight);

    // Huone
    createRoom();

    // Avatar
    createAvatar();

    window.addEventListener('resize', onWindowResize);
    animate();
}

function createRoom() {
    // Lattia (parketti epÃ¤tasaisuuksilla)
    const floorGeom = new THREE.PlaneGeometry(5,5,10,10);
    for(let i=0;i<floorGeom.vertices.length;i++){
        floorGeom.vertices[i].z = (Math.random()-0.5)*0.02;
    }
    const floorMat = new THREE.MeshStandardMaterial({color:0xdeb887, side:THREE.DoubleSide});
    const floor = new THREE.Mesh(floorGeom, floorMat);
    floor.rotation.x = -Math.PI/2;
    floor.position.y = 0;
    scene.add(floor);

    // SeinÃ¤t
    const wallMat = new THREE.MeshStandardMaterial({color:0xf0f0f0});
    const wall1 = new THREE.Mesh(new THREE.PlaneGeometry(5,2.5), wallMat);
    wall1.position.set(0,1.25,-2.5);
    scene.add(wall1);

    const wall2 = new THREE.Mesh(new THREE.PlaneGeometry(5,2.5), wallMat);
    wall2.position.set(0,1.25,2.5);
    wall2.rotation.y = Math.PI;
    scene.add(wall2);

    const wall3 = new THREE.Mesh(new THREE.PlaneGeometry(5,2.5), wallMat);
    wall3.position.set(-2.5,1.25,0);
    wall3.rotation.y = Math.PI/2;
    scene.add(wall3);

    const wall4 = new THREE.Mesh(new THREE.PlaneGeometry(5,2.5), wallMat);
    wall4.position.set(2.5,1.25,0);
    wall4.rotation.y = -Math.PI/2;
    scene.add(wall4);

    // Katto
    const ceiling = new THREE.Mesh(new THREE.PlaneGeometry(5,5), wallMat);
    ceiling.position.y = 2.5;
    ceiling.rotation.x = Math.PI/2;
    scene.add(ceiling);

    // Huonekaluja
    const table = new THREE.Mesh(
        new THREE.BoxGeometry(1,0.6,0.8),
        new THREE.MeshStandardMaterial({color:0x8B4513})
    );
    table.position.set(0,0.3,-1);
    scene.add(table);

    const chair = new THREE.Mesh(
        new THREE.BoxGeometry(0.5,0.4,0.5),
        new THREE.MeshStandardMaterial({color:0xA0522D})
    );
    chair.position.set(0.8,0.2,-0.8);
    scene.add(chair);
}

function createAvatar(){
    avatar = new THREE.Group();
    const body = new THREE.Mesh(
        new THREE.CylinderGeometry(0.25,0.25,0.8,8),
        new THREE.MeshStandardMaterial({color:0x4169E1, transparent:true, opacity:0.3})
    );
    body.position.y = 0.4;
    avatar.add(body);

    const head = new THREE.Mesh(
        new THREE.SphereGeometry(0.18,16,16),
        new THREE.MeshStandardMaterial({color:0xFFEBCD, transparent:true, opacity:0.3})
    );
    head.position.y = 0.9;
    avatar.add(head);

    scene.add(avatar);
}

async function startVR(){
    if(!navigator.xr){ alert("WebXR ei saatavilla."); return;}
    try{
        const supported = await navigator.xr.isSessionSupported('immersive-vr');
        if(!supported){ alert("VR ei tuettu"); return;}

        xrSession = await navigator.xr.requestSession('immersive-vr');
        await renderer.xr.setSession(xrSession);

        document.getElementById('arButton').style.display='none';
        document.getElementById('statusMessage').textContent='VR kÃ¤ynnistetty! Olet nyt 4-vuotiaan nÃ¤kÃ¶kulmassa.';

        xrSession.addEventListener('end', ()=>{
            xrSession = null;
            document.getElementById('arButton').style.display='inline-block';
            document.getElementById('statusMessage').textContent='VR-sessio pÃ¤Ã¤ttynyt.';
        });

    } catch(e){
        alert("VR kÃ¤ynnistys epÃ¤onnistui: "+e.message);
    }
}

function onWindowResize(){
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
}

function animate(){
    renderer.setAnimationLoop(()=>{
        renderer.render(scene,camera);
    });
}

document.getElementById('arButton').addEventListener('click', startVR);

window.addEventListener('load', init);
</script>
</body>
</html>
