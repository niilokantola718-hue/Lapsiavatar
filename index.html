<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>4-vuotiaan AR-perspektiivi</title>
<style>
  body { margin:0; overflow:hidden; font-family:Arial,sans-serif; background:black; }
  #info {
    position:absolute; top:20px; left:20px;
    background: rgba(0,0,0,0.8); color:white;
    padding:20px; border-radius:10px; max-width:400px;
    z-index:100;
  }
  button {
    padding:10px 20px; margin:5px;
    font-size:16px; border:none; border-radius:5px;
    cursor:pointer; background:#4CAF50; color:white;
  }
</style>
</head>
<body>

<div id="info">
  <h3>4-vuotiaan AR-perspektiivi</h3>
  <button id="startButton">ðŸš€ KÃ¤ynnistÃ¤ AR</button>
  <p id="status">Valmis.</p>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/jsm/webxr/ARButton.js"></script>
<script>
let scene, camera, renderer, floor;

function init() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x87CEEB);

    // Kamera 4-vuotiaan silmien korkeudella (~95 cm)
    camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.01, 50);
    camera.position.set(0, 0.95, 0); // 95 cm

    // Renderer
    renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.xr.enabled = true;
    document.body.appendChild(renderer.domElement);

    // Lattia parketilla epÃ¤tasaisuuksineen
    const floorGeo = new THREE.PlaneGeometry(10, 10, 20, 20);
    floorGeo.vertices.forEach(v => { v.z = Math.random()*0.05; });
    const floorMat = new THREE.MeshStandardMaterial({color:0xdeb887, roughness:0.8});
    floor = new THREE.Mesh(floorGeo, floorMat);
    floor.rotation.x = -Math.PI/2;
    scene.add(floor);

    // Huoneen seinÃ¤t ja katto
    const wallMat = new THREE.MeshStandardMaterial({color:0xffffff});
    const wall1 = new THREE.Mesh(new THREE.BoxGeometry(10,3,0.1), wallMat); wall1.position.set(0,1.5,-5); scene.add(wall1);
    const wall2 = new THREE.Mesh(new THREE.BoxGeometry(0.1,3,10), wallMat); wall2.position.set(-5,1.5,0); scene.add(wall2);
    const wall3 = new THREE.Mesh(new THREE.BoxGeometry(0.1,3,10), wallMat); wall3.position.set(5,1.5,0); scene.add(wall3);
    const ceiling = new THREE.Mesh(new THREE.BoxGeometry(10,0.1,10), wallMat); ceiling.position.set(0,3,0); scene.add(ceiling);

    // Valaistus
    const ambientLight = new THREE.AmbientLight(0xffffff,0.6); scene.add(ambientLight);
    const dirLight = new THREE.DirectionalLight(0xffffff,0.8); dirLight.position.set(5,10,5); scene.add(dirLight);

    // PÃ¶ytÃ¤
    const table = new THREE.Mesh(
        new THREE.BoxGeometry(1.5,0.75,1),
        new THREE.MeshStandardMaterial({color:0x8B4513})
    );
    table.position.set(0,0.375,-2); scene.add(table);

    // Tuoli
    const chair = new THREE.Mesh(
        new THREE.BoxGeometry(0.5,0.45,0.5),
        new THREE.MeshStandardMaterial({color:0xA0522D})
    );
    chair.position.set(1,-0.05,-1.5); scene.add(chair);

    // Lelut
    const toyMat = new THREE.MeshStandardMaterial({color:0xff6b6b});
    const toy1 = new THREE.Mesh(new THREE.SphereGeometry(0.2,16,16), toyMat); toy1.position.set(-1,0.2,-2.5); scene.add(toy1);
    const toy2 = new THREE.Mesh(new THREE.BoxGeometry(0.3,0.3,0.3), toyMat); toy2.position.set(1.2,0.15,-3); scene.add(toy2);

    window.addEventListener('resize', onWindowResize);
}

function onWindowResize() {
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
}

function animate() {
    renderer.setAnimationLoop(()=>{
        renderer.render(scene, camera);
    });
}

document.getElementById('startButton').addEventListener('click', ()=>{
    if (navigator.xr) {
        navigator.xr.isSessionSupported('immersive-ar').then((supported)=>{
            if(supported){
                const sessionInit = {optionalFeatures:['local-floor']};
                navigator.xr.requestSession('immersive-ar', sessionInit).then((session)=>{
                    renderer.xr.setSession(session);
                    document.getElementById('info').style.display='none';
                    animate();
                });
            } else {
                document.getElementById('status').textContent = "AR ei tuettu tÃ¤llÃ¤ laitteella.";
            }
        });
    } else {
        document.getElementById('status').textContent = "WebXR ei saatavilla.";
    }
});

init();
</script>
</body>
</html>
