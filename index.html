<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>6-vuotiaan näkökulma — lattia y=0.6</title>
<style>
  body{margin:0;padding:0;overflow:hidden;background:#000;font-family:-apple-system,BlinkMacSystemFont,sans-serif}
  #ui{
    position:absolute;left:0;top:0;width:100%;height:100%;
    display:flex;flex-direction:column;justify-content:center;align-items:center;
    z-index:1000;background:rgba(0,0,0,0.7)
  }
  button{padding:18px 36px;font-size:18px;border-radius:12px;border:none;background:linear-gradient(45deg,#FF6B6B,#4ECDC4);color:white;cursor:pointer}
  #status{color:white;margin-top:16px;text-align:center;max-width:85%}
</style>
</head>
<body>
  <div id="ui">
    <button id="startBtn">Aloita lapsen näkymä (simuloitu VR)</button>
    <div id="status">Valmis — lattia nostetaan nyt y=0.6</div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
  // --- Perusasetukset ---
  let scene, camera, renderer, avatar;
  const statusEl = document.getElementById('status');
  function setStatus(s){ statusEl.textContent = s; console.log(s); }

  // Lattian korkeus (pyydetty)
  const FLOOR_Y = 0.6; // <- tässä nostettu arvo (6-vuotiaan tuntuma)

  // Aloitus
  init();

  function init(){
    setStatus('Alustetaan 3D-sceneä...');
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x87CEEB);

    // Kamera pysyy käyttäjän (fyysisen) tasona — simuloimme lapsen näkökulmaa nostamalla lattiaa
    camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.01, 100);
    camera.position.set(0, 1.6, 2.5); // fyysisen pään likiarvo

    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Valaistus
    scene.add(new THREE.AmbientLight(0xffffff, 0.75));
    const d = new THREE.DirectionalLight(0xffffff, 0.6);
    d.position.set(5,10,5);
    scene.add(d);

    // Luodaan huonekokonaisuus
    createRoom();        // seinät, katto
    createParketFloor(); // parkettilattia (nostettu FLOOR_Y)
    createFurniture();   // huonekalut huomioivat lattian noston
    createAvatar();      // lapsi-avatar (visuaalinen referenssi)

    // Käynnistä nappi: simulated VR (ei vaadi WebXR:ää)
    document.getElementById('startBtn').addEventListener('click', startSimulatedVR);

    window.addEventListener('resize', onResize);
    setStatus('Valmis. Paina "Aloita lapsen näkymä".');
  }

  // --- Parkettilattia (teksturoitu canvasilla + epätasaisuudet) ---
  function createParketFloor(){
    // Luo canvas-tekstuuri puulankuille
    const canvas = document.createElement('canvas');
    canvas.width = 1024; canvas.height = 1024;
    const ctx = canvas.getContext('2d');

    // Tausta
    ctx.fillStyle = '#caa66b';
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // Piirrä lankkuja
    const plankCount = 12;
    const plankW = canvas.width / plankCount;
    for(let i=0;i<plankCount;i++){
      const x = i*plankW;
      // värivariaatio
      const shade = 30 - Math.floor(Math.random()*20);
      ctx.fillStyle = `rgb(${200-shade},${150-shade/2},${100-shade/3})`;
      ctx.fillRect(x,0,plankW,canvas.height);

      // juonteita
      ctx.strokeStyle = `rgba(0,0,0,${0.04 + Math.random()*0.04})`;
      ctx.lineWidth = 2;
      for(let j=0;j<6;j++){
        ctx.beginPath();
        const y = Math.random()*canvas.height;
        ctx.moveTo(x + Math.random()*10, y);
        ctx.quadraticCurveTo(x+plankW/2, y + (Math.random()-0.5)*80, x + plankW - Math.random()*10, y + (Math.random()-0.5)*10);
        ctx.stroke();
      }
    }

    const texture = new THREE.CanvasTexture(canvas);
    texture.wrapS = texture.wrapT = THREE.RepeatWrapping;
    texture.repeat.set(4,4);
    texture.anisotropy = renderer.capabilities.getMaxAnisotropy();

    // Geometria (useampi segmentti epätasaisuuksia varten)
    const geo = new THREE.PlaneGeometry(6,6, 40,40);
    // Pieniä epätasaisuuksia (±2 cm)
    for(let i=0;i<geo.attributes.position.count;i++){
      const px = geo.attributes.position.getX(i);
      const pz = geo.attributes.position.getZ(i);
      // satunnaista mutta pehmeää korkeuseroa
      const rand = (Math.sin(px*3.1 + pz*2.7) + Math.random()*0.6) * 0.01;
      geo.attributes.position.setY(i, rand);
    }
    geo.computeVertexNormals();
    geo.attributes.position.needsUpdate = true;

    const mat = new THREE.MeshPhongMaterial({ map: texture, side: THREE.DoubleSide, shininess: 10 });
    const floor = new THREE.Mesh(geo, mat);
    floor.rotation.x = -Math.PI/2;
    floor.position.y = FLOOR_Y; // *** tässä on pyydetty nostettu arvo ***
    scene.add(floor);
  }

  // --- Huone (seinät, katto) ---
  function createRoom(){
    const wallMat = new THREE.MeshPhongMaterial({ color: 0xf3f3f3 });
    // Huone kokoa pidin maltillisena (6x6 m), mutta suhteutetaan lattian nostoon:
    const w = 6, h = 3, d = 6;
    // Back wall (Z-)
    const back = new THREE.Mesh(new THREE.PlaneGeometry(w, h), wallMat);
    back.position.set(0, FLOOR_Y + h/2, -d/2);
    scene.add(back);
    // Front wall (Z+)
    const front = new THREE.Mesh(new THREE.PlaneGeometry(w, h), wallMat);
    front.position.set(0, FLOOR_Y + h/2, d/2);
    front.rotation.y = Math.PI;
    scene.add(front);
    // Left wall
    const left = new THREE.Mesh(new THREE.PlaneGeometry(d, h), wallMat);
    left.position.set(-w/2, FLOOR_Y + h/2, 0);
    left.rotation.y = Math.PI/2;
    scene.add(left);
    // Right wall
    const right = new THREE.Mesh(new THREE.PlaneGeometry(d, h), wallMat);
    right.position.set(w/2, FLOOR_Y + h/2, 0);
    right.rotation.y = -Math.PI/2;
    scene.add(right);
    // Katto
    const ceiling = new THREE.Mesh(new THREE.PlaneGeometry(w, d), new THREE.MeshPhongMaterial({ color: 0xeeeeee, side: THREE.DoubleSide }));
    ceiling.rotation.x = Math.PI/2;
    ceiling.position.set(0, FLOOR_Y + h, 0);
    scene.add(ceiling);
  }

  // --- Huonekalut (korkeudet säädetty suhteessa FLOOR_Y) ---
  function createFurniture(){
    const woodMat = new THREE.MeshPhongMaterial({ color: 0x8B5A2B });
    // Pöytä (pöydän y = lattia + 0.375)
    const table = new THREE.Mesh(new THREE.BoxGeometry(1.2, 0.75, 0.7), woodMat);
    table.position.set(0, FLOOR_Y + 0.375, -1.2);
    scene.add(table);
    // Tuolit
    const chair = new THREE.Mesh(new THREE.BoxGeometry(0.45, 0.45, 0.45), new THREE.MeshPhongMaterial({ color: 0xA0522D }));
    chair.position.set(0.9, FLOOR_Y + 0.225, -1.2);
    scene.add(chair);
    const chair2 = chair.clone();
    chair2.position.set(-0.9, FLOOR_Y + 0.225, -1.2);
    scene.add(chair2);
    // Kaappi (jalat lattian päällä)
    const cabinet = new THREE.Mesh(new THREE.BoxGeometry(0.9, 1.6, 0.45), new THREE.MeshPhongMaterial({ color: 0x5C4033 }));
    cabinet.position.set(2.2, FLOOR_Y + 0.8, -2);
    scene.add(cabinet);
    // Pieni lelulaatikko lattialla
    const box = new THREE.Mesh(new THREE.BoxGeometry(0.4,0.25,0.4), new THREE.MeshPhongMaterial({ color: 0xFF6B6B }));
    box.position.set(-1.5, FLOOR_Y + 0.125, 0.6);
    scene.add(box);
  }

  // --- Lapsi/avatar (pelkkä referenssi) ---
  function createAvatar(){
    avatar = new THREE.Group();
    const head = new THREE.Mesh(new THREE.SphereGeometry(0.16, 16, 16), new THREE.MeshPhongMaterial({ color: 0xFFE0A3, transparent:true, opacity:0.85 }));
    head.position.set(0, 0.9, -0.5); // visuaalinen sijainti suhteessa kameraan
    avatar.add(head);
    const body = new THREE.Mesh(new THREE.CylinderGeometry(0.16,0.18,0.4,12), new THREE.MeshPhongMaterial({ color: 0x3A7BD5, transparent:true, opacity:0.8 }));
    body.position.set(0, 0.55, -0.5);
    avatar.add(body);
    // Emme liitä avataria kameraan — simuloitu perspektiivi tehdään lattian nostolla
    scene.add(avatar);
  }

  // --- Simuloitu VR-käynnistys (ei vaadi WebXR) ---
  function startSimulatedVR(){
    document.getElementById('ui').style.display = 'none';
    setStatus('Simuloitu lapsenäkymä aktiivinen — katsele hiirellä/trackpadilla.');
    // Lisätään hiiri/trackpad-koukku katseluun (basic orbit-tyyli)
    enableMouseLook();
    renderer.setAnimationLoop(render);
  }

  // Yksinkertainen hiiri-katselu
  function enableMouseLook(){
    let isDown=false, lastX=0, lastY=0;
    const euler = new THREE.Euler(0,0,0,'YXZ');

    window.addEventListener('pointerdown', (e)=>{ isDown=true; lastX=e.clientX; lastY=e.clientY; });
    window.addEventListener('pointerup', ()=> isDown=false);
    window.addEventListener('pointermove', (e)=>{
      if(!isDown) return;
      const dx = (e.clientX - lastX) * 0.005;
      const dy = (e.clientY - lastY) * 0.005;
      lastX = e.clientX; lastY = e.clientY;
      euler.setFromQuaternion(camera.quaternion);
      euler.y -= dx;
      euler.x -= dy;
      euler.x = Math.max( -Math.PI/2, Math.min( Math.PI/2, euler.x ) );
      camera.quaternion.setFromEuler(euler);
    });
  }

  function render(){
    renderer.render(scene, camera);
  }

  function onResize(){
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  }
  </script>
</body>
</html>
