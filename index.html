<!DOCTYPE html>
<html>
<head>
    <title>Astu Lapsen Kehoon</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            font-family: Arial, sans-serif;
            background: #000;
        }
        #enterButton {
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%);
            z-index: 1000;
            padding: 20px 40px; 
            font-size: 24px; 
            background: #4CAF50;
            color: white; 
            border: none; 
            border-radius: 15px; 
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        #status {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
            max-width: 300px;
        }
    </style>
</head>
<body>
    <button id="enterButton" onclick="enterAvatarBody()">
        ðŸ‘¶ Astu Lapsen Kehoon
    </button>
    <div id="status">Ladataan...</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/jsm/loaders/GLTFLoader.js"></script>

    <script>
let scene, camera, renderer, avatar;
let isInAvatarBody = false;

function init() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x87CEEB);
    
    camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 1.6, 3);
    
    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.xr.enabled = true;
    document.body.appendChild(renderer.domElement);
    
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
    scene.add(ambientLight);
    
    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
    directionalLight.position.set(10, 20, 15);
    scene.add(directionalLight);
    
    const floorGeometry = new THREE.PlaneGeometry(20, 20);
    const floorMaterial = new THREE.MeshStandardMaterial({ color: 0x90EE90 });
    const floor = new THREE.Mesh(floorGeometry, floorMaterial);
    floor.rotation.x = -Math.PI / 2;
    scene.add(floor);
    
    createTestAvatar();
    
    document.getElementById('status').textContent = 'Valmis! Paina "Astu Lapsen Kehoon"';
    
    animate();
}

function createTestAvatar() {
    const group = new THREE.Group();
    
    const headGeometry = new THREE.SphereGeometry(0.3, 16, 16);
    const headMaterial = new THREE.MeshStandardMaterial({ color: 0xFFE0BD });
    const head = new THREE.Mesh(headGeometry, headMaterial);
    head.position.y = 1.2;
    head.userData.isHead = true;
    
    const bodyGeometry = new THREE.BoxGeometry(0.4, 0.6, 0.2);
    const bodyMaterial = new THREE.MeshStandardMaterial({ color: 0x4ECDC4 });
    const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
    body.position.y = 0.5;
    
    const armGeometry = new THREE.BoxGeometry(0.1, 0.4, 0.1);
    const armMaterial = new THREE.MeshStandardMaterial({ color: 0xFFE0BD });
    
    const leftArm = new THREE.Mesh(armGeometry, armMaterial);
    leftArm.position.set(-0.3, 0.7, 0);
    
    const rightArm = new THREE.Mesh(armGeometry, armMaterial);
    rightArm.position.set(0.3, 0.7, 0);
    
    const legGeometry = new THREE.BoxGeometry(0.15, 0.4, 0.15);
    const legMaterial = new THREE.MeshStandardMaterial({ color: 0x45B7D1 });
    
    const leftLeg = new THREE.Mesh(legGeometry, legMaterial);
    leftLeg.position.set(-0.1, 0.1, 0);
    
    const rightLeg = new THREE.Mesh(legGeometry, legMaterial);
    rightLeg.position.set(0.1, 0.1, 0);
    
    group.add(head);
    group.add(body);
    group.add(leftArm);
    group.add(rightArm);
    group.add(leftLeg);
    group.add(rightLeg);
    
    group.scale.set(0.7, 0.7, 0.7);
    group.position.y = 0.5;
    
    avatar = group;
    scene.add(avatar);
}

function enterAvatarBody() {
    if (!avatar) {
        alert("Avatar ei ole vielÃ¤ ladannut. Odota hetki.");
        return;
    }
    
    const button = document.getElementById('enterButton');
    button.style.display = 'none';
    
    // SIIRRY AVATARIN KEHOON VAikka WebXR EI TOIMISI
    camera.position.set(0, 1.2, 0);
    
    // LUKITSE KAMERA AVATARIIN
    avatar.add(camera);
    camera.position.set(0, 0.2, 0);
    
    isInAvatarBody = true;
    
    document.getElementById('status').innerHTML = 
        'ðŸ‘¶ Olet nyt lapsen kehossa!<br>WebXR ei saatavilla, mutta voit kokeilla 3D-kokemusta.';
    
    // YritÃ¤ WebXR silti
    startWebXR();
}

function startWebXR() {
    console.log("Tarkistetaan WebXR-tukea...");
    
    if (navigator.xr) {
        const trySessions = ['immersive-vr', 'immersive-ar'];
        
        const tryNextSession = (index) => {
            if (index >= trySessions.length) {
                console.log("Kaikki WebXR-session epÃ¤onnistuivat");
                return;
            }
            
            const sessionType = trySessions[index];
            console.log("YritetÃ¤Ã¤n:", sessionType);
            
            navigator.xr.isSessionSupported(sessionType).then((supported) => {
                if (supported) {
                    console.log(sessionType + " tuettu!");
                    return navigator.xr.requestSession(sessionType);
                } else {
                    console.log(sessionType + " ei tuettu");
                    return tryNextSession(index + 1);
                }
            }).then((session) => {
                if (session) {
                    console.log("WebXR sessio aloitettu:", sessionType);
                    renderer.xr.setSession(session);
                    document.getElementById('status').innerHTML = 
                        'ðŸŽ‰ WEBXR ONNISTUI! Olet VR-tilassa lapsen kehossa!';
                        
                    session.addEventListener('end', () => {
                        location.reload();
                    });
                }
            }).catch((error) => {
                console.error(sessionType + " epÃ¤onnistui:", error);
                tryNextSession(index + 1);
            });
        };
        
        tryNextSession(0);
    } else {
        console.log("WebXR ei tuettu selaimessa");
    }
}

function animate() {
    renderer.setAnimationLoop(() => {
        renderer.render(scene, camera);
    });
}

window.addEventListener('load', init);

window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});
    </script>
</body>
</html>

