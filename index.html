'<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lapsi Avatar - Vision Pro AR</title>
    <style>
        body { margin:0; padding:0; overflow:hidden; font-family: Arial, sans-serif; background: black; }
        #info {
            position: absolute; top: 20px; left: 20px; background: rgba(0,0,0,0.9);
            color: white; padding: 20px; border-radius: 10px; z-index: 100; max-width: 500px;
            border: 2px solid #4CAF50;
        }
        button {
            padding: 15px 30px; font-size: 18px; background: #4CAF50; color: white;
            border: none; border-radius: 10px; cursor: pointer; margin: 10px 5px; transition: all 0.3s;
        }
        button:hover { transform: scale(1.05); }
        #arButton { background: #9C27B0; }
        #testButton { background: #2196F3; }
        .status-box { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin: 15px 0; }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        #heightIndicator {
            position: absolute; bottom: 20px; left: 20px; background: rgba(0,0,0,0.9);
            color: white; padding: 15px; border-radius: 10px; border: 2px solid #FF6B6B; display: none;
        }
        #xrOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black;
            display: none; z-index: 1000; justify-content: center; align-items: center; color: white; font-size: 24px;
        }
    </style>
</head>
<body>
    <div id="info">
        <h2>üßí Lapsi Avatar - Vision Pro AR</h2>
        <div class="status-box">
            <p><strong>Vision Pro AR:</strong> K√§yt√§ WebXR:√§√§ saadaksesi oikean AR-kokemuksen</p>
            <p><em>T√§m√§ piilottaa Safari-ikkunan ja n√§ytt√§√§ kameran kuvan koko n√§yt√∂ll√§</em></p>
        </div>
        <button id="testButton">üîç Testaa WebXR-tukea</button>
        <button id="arButton">üöÄ K√§ynnist√§ Vision Pro AR</button>
        <div class="status-box">
            <div id="statusMessage">Valmis! Testaa ensin WebXR-tuki.</div>
        </div>
    </div>
    <div id="heightIndicator">
        <h3>üìè Lapsen Korkeus: 115cm</h3>
        <p>Olet nyt 6-vuotiaan lapsen n√§k√∂kulmassa</p>
    </div>
    <div id="xrOverlay">
        <div>WebXR-sessio k√§ynniss√§... Sulje palataksesi normaalitilaan</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script>
        let camera, scene, renderer, avatar;
        let xrSession = null;

        async function init() {
            updateStatus("Alustetaan...");
            
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.01, 1000);
            camera.position.set(0, 1.15, 5); // 6-vuotiaan silmien korkeus

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.xr.enabled = true;
            document.body.appendChild(renderer.domElement);

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 20, 5);
            scene.add(directionalLight);

            createVirtualObjects();
            createAvatar();
            await checkXRSupport();
            setupEventHandlers();
            animate();

            updateStatus("Valmis! Testaa WebXR-tuki ensin.");
        }

        function createVirtualObjects() {
            const colors = [0xFF6B6B, 0x4ECDC4, 0x45B7D1, 0x96CEB4, 0xFFEAA7];

            // Parkettilattia ep√§tasaisuuksineen
            const floorGeometry = new THREE.PlaneGeometry(10, 10, 20, 20);
            const floorMaterial = new THREE.MeshStandardMaterial({ color:0xDEB887, side:THREE.DoubleSide });
            for (let i=0;i<floorGeometry.attributes.position.count;i++){
                floorGeometry.attributes.position.setY(i, Math.random()*0.02);
            }
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI/2;
            floor.position.y = 0; // Y-taso pysyy maan tasolla
            scene.add(floor);

            // P√∂yt√§ 75cm
            const table = new THREE.Mesh(
                new THREE.BoxGeometry(2,0.75,1.5),
                new THREE.MeshStandardMaterial({ color:0x8B4513 })
            );
            table.position.set(0,0.375,-2);
            scene.add(table);

            // Tuoli 45cm
            const chair = new THREE.Mesh(
                new THREE.BoxGeometry(0.7,0.45,0.7),
                new THREE.MeshStandardMaterial({ color:0xA0522D })
            );
            chair.position.set(1.5,0.225,-1);
            scene.add(chair);

            // Lelut
            for (let i=0;i<8;i++){
                const size = 0.3 + Math.random()*0.4;
                const geometry = Math.random()>0.5 ? new THREE.SphereGeometry(size,16,16) : new THREE.BoxGeometry(size,size,size);
                const material = new THREE.MeshStandardMaterial({ color: colors[Math.floor(Math.random()*colors.length)] });
                const toy = new THREE.Mesh(geometry, material);
                toy.position.set((Math.random()-0.5)*8, size/2, -3 + (Math.random()-0.5)*4);
                scene.add(toy);
            }
        }

        function createAvatar() {
            const group = new THREE.Group();
            const body = new THREE.Mesh(new THREE.CylinderGeometry(0.25,0.25,0.8,8), new THREE.MeshStandardMaterial({ color:0x4169E1, transparent:true, opacity:0.3 }));
            body.position.y = 0.4;
            group.add(body);
            const head = new THREE.Mesh(new THREE.SphereGeometry(0.18,16,16), new THREE.MeshStandardMaterial({ color:0xFFEBCD, transparent:true, opacity:0.3 }));
            head.position.y = 0.9;
            group.add(head);
            avatar = group;
            scene.add(avatar);
        }

        async function checkXRSupport() {
            if (!navigator.xr) { updateStatus("‚ùå WebXR API ei saatavilla","error"); document.getElementById('arButton').style.display='none'; return; }
            try {
                const arSupported = await navigator.xr.isSessionSupported('immersive-ar');
                if (arSupported) { updateStatus("‚úÖ WebXR AR saatavilla!","success"); document.getElementById('arButton').style.display='inline-block'; }
                else { updateStatus("‚ùå WebXR AR ei saatavilla","error"); document.getElementById('arButton').style.display='none'; }
            } catch(e){ updateStatus("‚ùå WebXR-tarkistus ep√§onnistui:"+e.message,"error"); }
        }

        function setupEventHandlers() {
            document.getElementById('testButton').addEventListener('click', testXRSession);
            document.getElementById('arButton').addEventListener('click', startXRSession);
            window.addEventListener('resize', onWindowResize);
        }

        async function testXRSession() {
            if (!navigator.xr){ alert("WebXR ei saatavilla t√§ss√§ selaimessa."); return; }
            try{
                let sessionType='immersive-ar';
                let supported = await navigator.xr.isSessionSupported(sessionType);
                if(!supported){ sessionType='immersive-vr'; supported = await navigator.xr.isSessionSupported(sessionType);}
                if(supported){ const session = await navigator.xr.requestSession(sessionType,{requiredFeatures:['local-floor']}); await session.end(); alert
