<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>6-vuotiaan näkökulma VR</title>
    <style>
        body { margin:0; padding:0; overflow:hidden; background:#000; }
        #ui {
            position:absolute; top:0; left:0; width:100%; height:100%;
            display:flex; justify-content:center; align-items:center;
            z-index:1000; background: rgba(0,0,0,0.8);
            flex-direction: column;
        }
        button { padding:20px 40px; font-size:20px; margin:10px; cursor:pointer; border:none; border-radius:10px; background:#4CAF50; color:white;}
        #status { color:white; margin-top:20px; }
    </style>
</head>
<body>
<div id="ui">
    <button id="startButton">Käynnistä VR - 6-vuotias</button>
    <div id="status">Valmistellaan...</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
let scene, camera, renderer;
let xrSession = null;
const status = document.getElementById('status');

function updateStatus(msg){ status.textContent = msg; console.log(msg); }

function init(){
    updateStatus('Alustetaan VR-tilaa...');
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x87CEEB);

    // Kamera 6-vuotiaan silmien korkeudelle (~1.2 m)
    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.01, 100);
    camera.position.set(0,1.2,3);

    // Renderer
    renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.xr.enabled = true;
    document.body.appendChild(renderer.domElement);

    // Valaistus
    const ambientLight = new THREE.AmbientLight(0xffffff,0.6);
    scene.add(ambientLight);
    const dirLight = new THREE.DirectionalLight(0xffffff,0.8);
    dirLight.position.set(10,20,10);
    scene.add(dirLight);

    // Luo huone
    createRoom();

    // Luo lattia parketilla epätasaisuuksineen
    createFloor();

    // Lisää huonekaluja
    createFurniture();

    document.getElementById('startButton').addEventListener('click', startVRSession);
    window.addEventListener('resize', onWindowResize);

    updateStatus('Valmis - paina "Käynnistä VR"');
}

function createRoom(){
    const room = new THREE.Group();
    const wallMat = new THREE.MeshPhongMaterial({ color:0xdddddd });
    const floorMat = new THREE.MeshPhongMaterial({ color:0xdeb887 });

    // Seinät
    const backWall = new THREE.Mesh(new THREE.BoxGeometry(6,3,0.1), wallMat);
    backWall.position.set(0,1.5,-3);
    room.add(backWall);

    const leftWall = new THREE.Mesh(new THREE.BoxGeometry(0.1,3,6), wallMat);
    leftWall.position.set(-3,1.5,0);
    room.add(leftWall);

    const rightWall = new THREE.Mesh(new THREE.BoxGeometry(0.1,3,6), wallMat);
    rightWall.position.set(3,1.5,0);
    room.add(rightWall);

    const frontWall = new THREE.Mesh(new THREE.BoxGeometry(6,3,0.1), wallMat);
    frontWall.position.set(0,1.5,3);
    room.add(frontWall);

    // Katto
    const ceiling = new THREE.Mesh(new THREE.BoxGeometry(6,0.1,6), wallMat);
    ceiling.position.set(0,3,0);
    room.add(ceiling);

    scene.add(room);
}

function createFloor(){
    const floorGeo = new THREE.PlaneGeometry(6,6,20,20);
    const floorMat = new THREE.MeshPhongMaterial({ color:0xdeb887, side:THREE.DoubleSide });
    const floor = new THREE.Mesh(floorGeo,floorMat);
    floor.rotation.x = -Math.PI/2;
    floor.position.y = -0.8; // nostetaan niin että kamera näkee 6-vuotiaan silmin

    // epätasaisuuksia parkettiin
    for(let i=0;i<floorGeo.attributes.position.count;i++){
        const y = (Math.random()-0.5)*0.02; // ±2cm
        floorGeo.attributes.position.setY(i,y);
    }
    floorGeo.attributes.position.needsUpdate = true;
    floorGeo.computeVertexNormals();

    scene.add(floor);
}

function createFurniture(){
    const furnitureMat = new THREE.MeshPhongMaterial({ color:0x8B4513 });

    // Pöytä
    const table = new THREE.Mesh(new THREE.BoxGeometry(1,0.75,0.6), furnitureMat);
    table.position.set(0,-0.05,-1);
    scene.add(table);

    // Tuolit
    for(let i=-1;i<=1;i+=2){
        const chair = new THREE.Mesh(new THREE.BoxGeometry(0.4,0.45,0.4), furnitureMat);
        chair.position.set(i*0.5,-0.175,-1);
        scene.add(chair);
    }

    // Kaappi
    const cabinet = new THREE.Mesh(new THREE.BoxGeometry(0.8,1.2,0.4), furnitureMat);
    cabinet.position.set(2,-0.2,-2);
    scene.add(cabinet);
}

async function startVRSession(){
    updateStatus('Yritetään käynnistää VR...');
    try{
        const session = await navigator.xr.requestSession('immersive-vr',{ optionalFeatures:['local-floor'] });
        xrSession = session;
        await renderer.xr.setSession(session);
        document.getElementById('ui').style.display='none';
        renderer.setAnimationLoop(render);
        updateStatus('VR-sessio käynnistynyt! Näet maailman 6-vuotiaan silmin.');
    }catch(e){
        updateStatus('VR-sessio epäonnistui: '+e.message);
        console.error(e);
    }
}

function onWindowResize(){
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
}

function render(){
    renderer.render(scene,camera);
}

window.addEventListener('load',init);
</script>
</body>
</html>
