<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8" />
  <title>Lapsen perspektiivi VR-huone</title>
  <style>
    body { margin: 0; overflow: hidden; background: black; }
    #startBtn {
      position: absolute;
      top: 20px; left: 20px;
      padding: 10px 20px;
      font-size: 18px;
      z-index: 10;
    }
  </style>
</head>
<body>
  <button id="startBtn">Käynnistä VR</button>

  <script type="module">
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.module.js';
    import { VRButton } from 'https://cdn.jsdelivr.net/npm/three@0.157.0/examples/jsm/webxr/VRButton.js';

    let scene, camera, renderer;

    function init() {
      // Luodaan perusscene ja kamera
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0xddddff);

      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100);
      camera.position.set(0, 1.15, 2); // 6-vuotiaan silmien korkeus

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.xr.enabled = true;
      document.body.appendChild(renderer.domElement);

      // Lisää VR-nappi
      document.body.appendChild(VRButton.createButton(renderer));

      // Valot
      const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 1.2);
      hemiLight.position.set(0, 5, 0);
      scene.add(hemiLight);

      const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
      dirLight.position.set(3, 10, 5);
      scene.add(dirLight);

      // Lattia (parketti)
      const floorTexture = new THREE.TextureLoader().load('https://cdn.pixabay.com/photo/2017/06/21/16/01/floor-2426667_1280.jpg');
      floorTexture.wrapS = floorTexture.wrapT = THREE.RepeatWrapping;
      floorTexture.repeat.set(4, 4);
      const floorMat = new THREE.MeshStandardMaterial({ map: floorTexture });
      const floorGeo = new THREE.PlaneGeometry(10, 10);
      const floor = new THREE.Mesh(floorGeo, floorMat);
      floor.rotation.x = -Math.PI / 2;
      scene.add(floor);

      // Yksinkertaiset seinät
      const wallMat = new THREE.MeshStandardMaterial({ color: 0xffffff });
      const wallGeo = new THREE.BoxGeometry(10, 3, 0.1);

      const wallBack = new THREE.Mesh(wallGeo, wallMat);
      wallBack.position.set(0, 1.5, -5);
      scene.add(wallBack);

      const wallFront = new THREE.Mesh(wallGeo, wallMat);
      wallFront.position.set(0, 1.5, 5);
      scene.add(wallFront);

      const wallLeft = new THREE.Mesh(wallGeo, wallMat);
      wallLeft.rotation.y = Math.PI / 2;
      wallLeft.position.set(-5, 1.5, 0);
      scene.add(wallLeft);

      const wallRight = new THREE.Mesh(wallGeo, wallMat);
      wallRight.rotation.y = Math.PI / 2;
      wallRight.position.set(5, 1.5, 0);
      scene.add(wallRight);

      // Pieni pöytä lapsen korkeudelle
      const tableGeo = new THREE.BoxGeometry(0.6, 0.4, 0.4);
      const tableMat = new THREE.MeshStandardMaterial({ color: 0x8b4513 });
      const table = new THREE.Mesh(tableGeo, tableMat);
      table.position.set(0, 0.2, -1);
      scene.add(table);

      // Renderöintisilmukka
      renderer.setAnimationLoop(() => {
        renderer.render(scene, camera);
      });
    }

    // Käynnistä VR-nappi
    document.getElementById('startBtn').addEventListener('click', () => {
      if (!renderer) init();
      renderer.xr.enabled = true;
      renderer.xr.setSession(null); // varmuuden vuoksi nollataan
      navigator.xr.requestSession("immersive-vr", { requiredFeatures: [] })
        .then(session => renderer.xr.setSession(session))
        .catch(err => alert("VR-istunnon käynnistys epäonnistui: " + err));
    });

    window.addEventListener('resize', () => {
      if (camera && renderer) {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }
    });
  </script>
</body>
</html>
