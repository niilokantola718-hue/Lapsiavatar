<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>4-vuotiaan VR</title>
<style>
    body { margin:0; padding:0; overflow:hidden; background:black; }
    #info {
        position:absolute; top:20px; left:20px; background:rgba(0,0,0,0.9);
        color:white; padding:20px; border-radius:10px; z-index:100; max-width:400px;
    }
    button { padding:10px 20px; font-size:16px; margin:5px; cursor:pointer; }
</style>
</head>
<body>
<div id="info">
    <button id="startVR">ðŸš€ KÃ¤ynnistÃ¤ VR 4-vuotiaan nÃ¤kÃ¶kulma</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
<script>
let scene, camera, renderer, xrSession;

init();

function init(){
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x87CEEB); // taivas
    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.01, 1000);

    renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.xr.enabled = true;
    document.body.appendChild(renderer.domElement);

    // valaistus
    const ambient = new THREE.AmbientLight(0xffffff, 0.6);
    scene.add(ambient);
    const dirLight = new THREE.DirectionalLight(0xffffff,0.8);
    dirLight.position.set(10,20,10);
    scene.add(dirLight);

    // Lattia parkettina epÃ¤tasaisuuksineen
    const floorGeo = new THREE.PlaneGeometry(10,10,20,20);
    const floorMat = new THREE.MeshStandardMaterial({color:0xdeb887, side:THREE.DoubleSide});
    const floor = new THREE.Mesh(floorGeo, floorMat);
    floor.rotation.x = -Math.PI/2;
    // epÃ¤tasaisuuksia vertexeihin
    floorGeo.vertices.forEach(v => { v.z = Math.random()*0.05; });
    floor.position.y = 0;
    scene.add(floor);

    // PÃ¶ytÃ¤ ja tuoli esimerkkeinÃ¤
    const table = new THREE.Mesh(
        new THREE.BoxGeometry(2,0.75,1),
        new THREE.MeshStandardMaterial({color:0x8B4513})
    );
    table.position.set(0,0.375,-2);
    scene.add(table);

    const chair = new THREE.Mesh(
        new THREE.BoxGeometry(0.5,0.45,0.5),
        new THREE.MeshStandardMaterial({color:0xA0522D})
    );
    chair.position.set(1,0.225,-1.5);
    scene.add(chair);

    window.addEventListener('resize', onWindowResize);
}

document.getElementById('startVR').addEventListener('click', async ()=>{
    if(!navigator.xr){ alert("WebXR ei saatavilla."); return; }
    const supported = await navigator.xr.isSessionSupported('immersive-vr');
    if(!supported){ alert("VR ei tuettu."); return; }

    try{
        xrSession = await navigator.xr.requestSession('immersive-vr', {requiredFeatures:['local-floor']});
        await renderer.xr.setSession(xrSession);

        // asetetaan 4-vuotiaan korkeus n. 1.0 m
        const referenceSpace = await xrSession.requestReferenceSpace('local-floor');
        const offsetSpace = referenceSpace.getOffsetReferenceSpace(new XRRigidTransform({y:-0.6}));
        renderer.xr.setReferenceSpace(offsetSpace);

        animate();
    }catch(e){ console.error(e); alert("VR kÃ¤ynnistys epÃ¤onnistui: "+e);}
});

function animate(){
    renderer.setAnimationLoop(()=>{
        renderer.render(scene,camera);
    });
}

function onWindowResize(){
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
}
</script>
</body>
</html>
